---
title: 单片机
---
# 1、80C51的结构和原理

## 1.1  8051内部结构  
MCS-5系列：  
	以80C51为基格的CMOS产品：80C51系列
### 存储器配置
ROM 
EPROM 
ROMLess 
FLASH 

### CPU： 8位
布尔处理 
时钟电路 
总线控制 

### 存储器
ROM ：4KB/8KB  
RAM ：128B/256B  
### I/O 
 并口 ：4 $\times$ 8位  
UART （串口）1个  
定时计数器 16位 2个  
中断源 5个  

## 1.2  8051 的 CPU
### 1.2.1  功能单元  
#### 运算器
ALU 算术/逻辑部件

A / ACC 累加器  
	8位，存放操作数

B 寄存器  
	乘除法运算
	乘法：两个数取自 A 和 B ；结果高 8 位存于 B，低 8 位存于 A。
	除法：被除数取自 A，除数取自 B；结果商存于 A，余数存于 B。

PSW 程序状态字  
	程序运行状态与信息

|  |  |  |       |       |  | | |
|--|--|---|------|-------|--|-|-|
|CY|AC|FO|**RS1**|**RS0**|OV|-|P|


十进制调整电路

#### 控制器
IR 指令寄存器  
ID 指令译码器  

PC 程序计数器 （16位）  
	存放 cpu 执行的下一条指令
	复位  计数 置数  

译码逻辑及时钟  

#### 时序
![Pasted image 20220525220644](http://pic.qiniu.kicre.top/Pasted%20image%2020220525220644.png)
单周期单字节指令再执行过程中的 ALE 脉冲  
一个**指令周期**含若干个**机器周期**（单、双、四周期）
一个**机器周期**分6个**状态周期Si**  
每个**状态周期**含两个**震荡周期**即相位 P1、P2  
**震荡周期**由震荡时钟产生

#### 其他
DPTR 数据指针  

SP 堆栈指针  

### 1.2.2  时钟
**XTAL1**（19）、**XTAL2**（18）
#### 内部时钟方式

#### 外部时钟方式

### 1.2.3  复位  
使单片机处于确定的初始状态

#### 复位电路
上电复位  
按键上电复位  

#### 复位后
##### PC = 0000H 
CPU 中用于存放下一条指令地址的寄存器
  
##### RAM   随机
运行中复位不改变RAM内容

##### SFR 殊功能寄存器  
  
P0~P3 = FFH  
SP = 07H   一＞堆栈指针  
IP、 IE、 PCON ：有效位为0  
PSW ＝ 001H（状态字）  

## 1.3  存储器组织
逻辑上分为三个空间：  

| | |
|--|--|
|程序内存（片内、片外）统一编址|MOVC|
|数据存储器（片内）|MOV|
|数据存储器（片外）|MOVX|

RAM 随机写掉电丢失  
ROM 只读，写入不易改写，掉电不丢失  

### 1.3.1  片内/片外存储器选择  
$\overline{EA}$ = 1 ——片内，超过片内容量时，访问片外  
$\overline{EA}$ = 0 ——片外

### 1.3.2   程序存储器配置
**片外 RAM （64KB）**  
0000H~FFFFH  （64KB） （外部 RAM 或 I/O ）

**片内 RAM （256B）**  
工作寄存器区  00H ~ 1FH  （32B）  
位寻址区  20H ~ 2FH  （16B）  
通用 RAM 区  30H ~ 7FH  （80B）  
SFR 区  直接寻址访问  7FH ~ FFH  （128B）

![Pasted image 20220525185212](http://pic.qiniu.kicre.top/Pasted%20image%2020220525185212.png)
#### 1.3.2.1  工作寄存器区（含寄存器组 0 ～ 3）  
寄存器组 0 ：00H ～ 07H  
寄存器组 1 ：08H ～ 0FH  
寄存器组 2 ：10H ～ 17H  
寄存器组 3 ：18H ～ 1FH  
##### 当前工作寄存器组选择  
PSW 中： 以 RS1.RS0 选择  

| | | | | | | | |
|--|--|--|--|--|--|--|--|
|CY|AC|FO|**RS1**|**RS0**|OV|-|P|
#### 1.3.2.2  通用RAM区  
30H ～ 7FH （共80B）  
数据缓冲  
**堆栈**  
SP 拾示顶堆指针  （复位时SP＝07H）  
系统初始化通常**重新设置**

### 1.3.3  特殊功能寄器（ SFR  + PC ）  
基本型片有21个 SFR 离散分布  （80H ～ FFH）  
PC 寻址范围：0000H ~ FFFFH，即 0 ~ 64KB

#### 运算器相关（3个）
A  累加器  
B  寄存器  
PSW  程序状态字寄存器  

#### I/O 口相关（7个）
P0 ~ P3  （并行）  
串行：  
SBUF 串行数据缓冲器  SBUF是指串行口中的两个缓冲寄存器，一个是发送寄存器，一个是接收寄存器，在物理结构上是完全独立的，但地址是重叠的。它们都是字节寻址的寄存器，字节地址均为99H。
SCON 串行控制/状态寄存器  
PCON  电源控制寄存器  

#### 指针类（3个）
PC 程序计数器  
	复位时 = 0000H  
SP 堆栈指针  
	复位时 = 07H  
DPTR 数据指针  
	DPH + DPL

#### 定时计数器相关（6个）  
THO 、 TLO  
THO 、 TLO  
TMOD  定时器方式寄存器  
TCON  定时器控制寄存器  
#### 中断相关（2个）
IE  中断允许寄存器  
IP  中断优先级寄存器：2 级优先

### 寄存器寻址
![Pasted image 20220525224122](http://pic.qiniu.kicre.top/Pasted%20image%2020220525224122.png)
\#20H 为**操作数**，\#30H 为**地址**。
R0 = 30H  @R0 = 20H

## 1.4  80C51的并行口  
### 1.4.1  P0，P2的结构  
P0 作通用 I/O 为**准双向口**！  
P0 作地址/数据总线（当 EA ＝ 0 或”MOVX”类传送时 C ＝ 1 ）

输**出**时，**地址**（低8位）/数据 信息分时时出现在输出引脚  
输**入**时，先输出地址，然后**自动向锁存器写1**，再读引脚。此时为**真正双向口**。  

P2 可与地址总线（高8位）复用。作通用 I/O 为**准双向口**！  

**16 位地址总线由 P0 提供低 8 位地址， P2 提供高 8 位地址。**

### 1.4.2  P1、P3 的结构
P1 仅为通用**准双向口**。  

P3 第二功能：  

|接口|功能|
|--|--|
|P3.0|RXD（串行口输入）|
|P3.1|TXD（串行口输出）|
|P3.2|$\overline{INT0}$（外部中断 0 输入）|
|P3.3|$\overline{INT1}$（外部中断 1 输入）|
|P3.4|T0（定时器 0 的外部输入）|
|P3.5|T1（定时器 1 的外部输入）  |
|P3.6|$\overline{WR}$（片外数据存储器“写”选通控制输出）|
|P3.7|$\overline{RD}$ （片外数据存储器“读”选通控制输出）|

## 1.5  80C51单片机最小系统
### 1.5.1  最小系统的硬件构成
![Pasted image 20220525200258](http://pic.qiniu.kicre.top/Pasted%20image%2020220525200258.png)
RST 复位信号

XTAL1 时钟晶振  
XTAL2 时钟晶振

### 1.5.2  增加简单 I/O 设备    
按键、二极管

**P0接有1K上拉电阻排，作为 2003 口和 P0 口公共上拉电图  
P3，P2，P3均接有4.7K上拉电阳**

# 2、C51 语言编程基础
## 2.1  指令集概述
### 指令集中的描述符号

|描述符号|含义|
|---|---|
|Rn|工作寄存器 R0 ~ R7|
|Ri|间接寻址寄存器 RO、R1|
|Direct|直接地址，包括内部 128B RAM 单元地址、26个SFR地|
|＃data|8位常数|
|＃data16|16位常数|
|addr 16|16位目的地址|
|addr 11|11位目的地址|
|rel|8位带符号的偏移地址|
|DPTR|16位外部数据指针存器|
|bit|可直接位寻址的位|
|--|--
|A|累加器  
|B|寄存器B  
|C|进、借位标志位，或位累加器
|＠|间接寄存器或基址寄存器的前缀
|/|指定位求反  
|(x)|x中的内容  
|((x))|x中的地址中的内容  
|＄|当前指令存放的地址

**MCS-51**指令格式：  
	\[标号]: 操作码助记符 \[第一操作数] \[第二操作数] ; \[注释]

### 分类
![Pasted image 20220525234539](http://pic.qiniu.kicre.top/Pasted%20image%2020220525234539.png)
![Pasted image 20220525234600](http://pic.qiniu.kicre.top/Pasted%20image%2020220525234600.png)
## 2.2  数据传送类
### 2.2.1 内部 RAM 数据传送类
#### 一般数据传指令
![Pasted image 20220526000007](http://pic.qiniu.kicre.top/Pasted%20image%2020220526000007.png)
#### 栈操作指令

#### 字节交换指令

### 2.2.2  外部 RAM 数据传送
![Pasted image 20220526000454](http://pic.qiniu.kicre.top/Pasted%20image%2020220526000454.png)

### 2.2.3  查表指令
![Pasted image 20220526000431](http://pic.qiniu.kicre.top/Pasted%20image%2020220526000431.png)

## 2.3  算术运算指令

## 2.4  

## 2.5  

## 2.6  


# 3. 中断
![Pasted image 20220526114728](http://pic.qiniu.kicre.top/Pasted%20image%2020220526114728.png)
